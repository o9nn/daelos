%%{init: {'theme': 'dark', 'themeVariables': { 'primaryColor': '#1a1a2e', 'primaryTextColor': '#eee', 'primaryBorderColor': '#7C3AED', 'lineColor': '#7C3AED', 'secondaryColor': '#16213e', 'tertiaryColor': '#0f3460', 'background': '#0a0a0f', 'mainBkg': '#1a1a2e', 'nodeBorder': '#7C3AED', 'clusterBkg': '#16213e', 'clusterBorder': '#7C3AED', 'titleColor': '#fff', 'edgeLabelBackground': '#1a1a2e'}}}%%

flowchart TB
    subgraph USER["ğŸ‘¤ USER INTERACTION LAYER"]
        direction LR
        UI[("ğŸ–¥ï¸ Desktop UI")]
        DASH["ğŸ“Š Cognitive Dashboard"]
        CHAT["ğŸ’¬ Chat Interface"]
    end

    subgraph PRESENTATION["ğŸ¨ PRESENTATION LAYER (daelos)"]
        direction LR
        WM["ğŸªŸ Window Manager"]
        TB["ğŸ“Œ Taskbar"]
        FS["ğŸ“ File System"]
        APPS["ğŸ“± Applications"]
    end

    subgraph COGNITIVE["ğŸ§  COGNITIVE LAYER"]
        direction TB
        
        subgraph ORCHESTRATOR["âš¡ Daedalus Orchestrator"]
            ORCH["Central Coordinator"]
        end

        subgraph AWARENESS["ğŸ‘ï¸ AWARENESS TRIAD"]
            direction LR
            ENT["ğŸŒŸ Entelechy<br/>Self-Actualization"]
            AUTO["ğŸ”® Autognosis<br/>Self-Knowledge"]
            RR["ğŸ¯ Relevance<br/>Realization"]
        end

        subgraph AGENCY["ğŸ­ AGENCY TRIAD"]
            direction LR
            AN["ğŸª Agent-Neuro<br/>Personality"]
            ONTO["ğŸ§¬ Ontogenesis<br/>Evolution"]
            NPU["âš™ï¸ NPU Driver<br/>Inference"]
        end
    end

    subgraph INFERENCE["ğŸ”¥ INFERENCE LAYER"]
        direction LR
        WEBLLM["ğŸŒ WebLLM<br/>Local GPU"]
        PROMPT["ğŸ’­ Prompt API<br/>Browser AI"]
        EXT["ğŸ”Œ External<br/>APIs"]
    end

    subgraph PERSISTENCE["ğŸ’¾ PERSISTENCE LAYER"]
        direction LR
        IDB[("ğŸ—„ï¸ IndexedDB")]
        GGUF["ğŸ“¦ GGUF Models"]
        KERNELS["ğŸ§¬ Kernel Genomes"]
    end

    %% User to Presentation
    UI --> WM
    DASH --> ORCH
    CHAT --> AN

    %% Presentation to Cognitive
    WM --> |"Window Focus"| RR
    TB --> |"Process State"| ENT
    FS --> |"Memory Access"| AUTO
    APPS --> |"Tool Invocation"| NPU

    %% Orchestrator connections
    ORCH --> ENT
    ORCH --> AUTO
    ORCH --> RR
    ORCH --> AN
    ORCH --> ONTO
    ORCH --> NPU

    %% Awareness Triad interactions
    ENT <--> |"Actualization<br/>Metrics"| AUTO
    AUTO <--> |"Salience<br/>Landscape"| RR
    RR <--> |"Progress<br/>Tracking"| ENT

    %% Agency Triad interactions
    AN <--> |"Behavioral<br/>Modes"| ONTO
    ONTO <--> |"Kernel<br/>Requests"| NPU
    NPU <--> |"Personality<br/>Inference"| AN

    %% Cross-Triad interactions
    ENT -.-> |"Growth Goals"| ONTO
    AUTO -.-> |"Self-Model"| AN
    RR -.-> |"Attention"| NPU
    AN -.-> |"Emotional State"| ENT
    ONTO -.-> |"Capabilities"| AUTO
    NPU -.-> |"Relevance Scores"| RR

    %% Cognitive to Inference
    NPU --> WEBLLM
    NPU --> PROMPT
    NPU --> EXT

    %% Cognitive to Persistence
    AUTO --> IDB
    ONTO --> KERNELS
    NPU --> GGUF
    ENT --> IDB

    %% Styling
    classDef userLayer fill:#7C3AED,stroke:#9F7AEA,stroke-width:2px,color:#fff
    classDef presLayer fill:#3B82F6,stroke:#60A5FA,stroke-width:2px,color:#fff
    classDef cogLayer fill:#10B981,stroke:#34D399,stroke-width:2px,color:#fff
    classDef infLayer fill:#F59E0B,stroke:#FBBF24,stroke-width:2px,color:#fff
    classDef persLayer fill:#EF4444,stroke:#F87171,stroke-width:2px,color:#fff
    classDef orchNode fill:#EC4899,stroke:#F472B6,stroke-width:3px,color:#fff

    class UI,DASH,CHAT userLayer
    class WM,TB,FS,APPS presLayer
    class ENT,AUTO,RR,AN,ONTO,NPU cogLayer
    class ORCH orchNode
    class WEBLLM,PROMPT,EXT infLayer
    class IDB,GGUF,KERNELS persLayer
